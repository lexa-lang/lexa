import list
import args
import bench


effect Emit(e: Int): Unit

def range(l: Int, u: Int): Unit / Emit =
  if(l > u) {
    ()
  } else {
    do Emit(l);
    range(l + 1, u)
  }

def run(n: Int) = {
  var s = 0;
  try {
    range(0, n);
    s
  } with Emit { (e: Int) =>
    s = s + e;
    resume(())
  }
}

def main() = ignore[WrongFormat] {commandLineArgs() match {
  case Nil() => println("Expects one argument")
  case Cons(x, Cons(y, Nil())) => 
    println("Measuring internal running time")
    val t = timed{ run(x.toInt); () }
    println("Nanosecond used: " ++ show(t))
  case Cons(x, Nil()) =>
    val r = run(x.toInt)
    println(r)
  case other => println("Expects one argument, not '" ++ show(size(other)) ++ "'")
}
}
