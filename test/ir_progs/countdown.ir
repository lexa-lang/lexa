effect State {
    dcl get
    dcl set
}

def countdown(state_stub) {
    let i = raise state_stub.get 0 in
    let cond = i == 0 in
    if cond then
        i
    else
        let arg = i - 1 in
        let _ = raise state_stub.set arg in
        countdown(state_stub)
}

obj state(env) {
    def get(_) { 
        let s = env[0] in
        s[0]
    }

    def set(i) { 
        let s = env[0] in
        let _ = s[0] := i in
        0
    }
}

def body(env, state_stub) {
    countdown(state_stub)
}

def run(n) {
    let s = newref <n> in
    handle <s>
        body
    with state: State
}

def main() {
    let arg1 = ~readInt() in
    let arg2 = run(arg1) in
    ~printInt(arg2)
}